---
layout: post
title:  "文本纠错开发实践总结"
date:   2023-01-03 09:20:08 +0800
category: "AI"
published: true
---
做了一段时间的文本纠错了。现在将一些比较好的经验做法总结如下。
<!--more-->

# 1、 纠错数据的生成
## 1）使用拼音输入法
通过调用拼音输入法API来构造数据。具体生成规则如下：
在一条句子中，随机选取 1-3 个 token，若不是中文或英文字母（标点、特殊字符等），直接返回原始 token，否则获取其拼音序列，对拼音序列随机进行以下操作：

- 缩写: 当为最后一个字时，仅获取首字母。如：pinyin -> piny
- 删除: 当拼音序列长度大于 1 时，随机删除 1 个字母。如：pinyin -> piyin
- 增加: 返回带有冗余字母的拼音序列，冗余字母从字母混淆集中随机获取。如：pinyin -> pionyin
- 修改: 返回含有错误字母的拼音序列，错误字母从字母混淆集中随机获取。如：pinyin -> pinyim
- 不操作: 直接返回原始拼音序列。
  
其中，字母混淆集 confusion_letters.txt 由 26 键键位中相邻的字母构成。

基于得到的拼音序列，通过输入工具 API 获取用于替换原始文本的候选词。

严格选择模式将随机地从候选词中挑选一个和原始文本长度相同的词语，宽松选择模式将随机地从候选词中挑选一个和原始文本长度相差不超过 1 的词语。

数据格式
结果文件为 JSON 格式。每条数据包含三个字段：

original_text: 生成的可能含有错误的文本
correct_text: 不含有错误的原始文本
flag: 是否包含错误，有误为 "false"，无误为 "true"
如：

[
  {
    "original_text": "助力书香北极建设 开启5G+阅读新体验",
    "correct_text": "助力书香北京建设 开启5G+阅读新体验",
    "flag": false
  }
]

输入法api可以使用百度的：
curl -X GET 'http://olime.baidu.com/py?input=ceshiyixa&inputtype=py&bg=0&ed=20&result=hanzi&resultcoding=unicode&ch_en=0&clientinfo=web&version=1'

以上做法来源于：
https://openbayes.com/console/open-tutorials/containers/vOJGMcsBqbf

## 2）音近字直接替换
随机选择中文字符，替换为音近的字。选择字符时，应避开专有名词和人名。替换字符应去掉生僻字。
## 3）形近字直接替换
随机选择中文字符，替换为形近的字。应避开专有名词和人名。替换字符应去掉生僻字。
## 4）少字错误构造
随机删除中文字符。应避开专有名词和人名。
## 5）多字错误构造
随机添加中文字符。应避开专有名词和人名。添加字符应去掉生僻字。
## 6）乱序错误构造
随机交换前后相邻的词语。


# 2、模型
目前，Gector是主流的模型，该模型由grammarly开发。网络上也有适配中文版的代码。
https://github.com/cofe-ai/fast-gector

# 3、召回排序
获取模型结果后。根据结构获得候选，然后使用ngram语言模型、结合音近形近距离综合打分，采用得分最高的候选项。也可以使用模型进行打分。
