---
layout: post
title:  "ROPE位置编码"
date:   2025-06-24 09:20:08 +0800
category: "AI"
published: true
---

ROPE位置编码的文章很多，苏神的博客也讲得很清楚，为什么我还要写一篇？因为我想按照自己的思路捋一下，就酱紫。

<!--more-->

## 1、为什么需要位置编码-Transformer的对称性缺陷
<div id="position-demo" style="width: 100%; height: 200px; border: 1px solid #ccc; margin: 20px 0; position: relative; background: #f9f9f9;">
  <div class="token" style="position: absolute; width: 60px; height: 40px; background: #4CAF50; color: white; text-align: center; line-height: 40px; border-radius: 5px; transition: all 0.5s ease;">Token1</div>
  <div class="token" style="position: absolute; width: 60px; height: 40px; background: #2196F3; color: white; text-align: center; line-height: 40px; border-radius: 5px; transition: all 0.5s ease;">Token2</div>
  <div class="token" style="position: absolute; width: 60px; height: 40px; background: #FF9800; color: white; text-align: center; line-height: 40px; border-radius: 5px; transition: all 0.5s ease;">Token3</div>
</div>

<button onclick="shuffleTokens()" style="margin: 10px 0; padding: 8px 16px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer;">打乱顺序</button>
<button onclick="resetTokens()" style="margin: 10px 0; padding: 8px 16px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer;">重置位置</button>

<script>
let positions = [
  {left: 50, top: 80},
  {left: 150, top: 80}, 
  {left: 250, top: 80}
];

function initTokens() {
  const tokens = document.querySelectorAll('#position-demo .token');
  tokens.forEach((token, index) => {
    token.style.left = positions[index].left + 'px';
    token.style.top = positions[index].top + 'px';
  });
}

function shuffleTokens() {
  const tokens = document.querySelectorAll('#position-demo .token');
  const shuffledPositions = [...positions].sort(() => Math.random() - 0.5);
  
  tokens.forEach((token, index) => {
    token.style.left = shuffledPositions[index].left + 'px';
    token.style.top = shuffledPositions[index].top + 'px';
  });
}

function resetTokens() {
  initTokens();
}

// 页面加载时初始化
document.addEventListener('DOMContentLoaded', initTokens);
</script>

<p style="color: #666; font-size: 14px; margin-top: 10px;">
💡 点击"打乱顺序"按钮可以看到，即使token的位置发生变化，Transformer也无法区分它们的相对位置关系。这就是为什么需要位置编码的原因。
</p>
